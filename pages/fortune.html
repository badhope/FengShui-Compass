<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>ä»Šæ—¥è¿åŠ¿ Â· ç”Ÿè¾°å…«å­—æµ‹ç®— - å›½é£ç„æ˜“</title>
    <style>
        /* å…¨å±€å˜é‡ä¸åŸºç¡€æ ·å¼ï¼ˆä¿æŒé£æ ¼ç»Ÿä¸€ï¼‰ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "SimHei", "Microsoft YaHei", "PingFang SC", sans-serif;
        }
        :root {
            /* å›½é£ä¸»è‰²è°ƒ */
            --color-black: #0a0a0a; /* ç„é»‘ */
            --color-red: #c8102e; /* æœ±ç ‚çº¢ */
            --color-gold: #ffd700; /* éé‡‘ */
            --color-green: #228b22; /* é’é»›ç»¿ */
            --color-blue: #1e90ff; /* æ°´è“ */
            --color-gray-light: #e0e0e0; /* æµ…ç° */
            --color-gray-dark: #333; /* æ·±ç° */
            
            /* å¹´è½»æ¨¡å¼å˜é‡ */
            --font-size-base: 16px;
            --font-size-title: 20px;
            --font-size-subtitle: 18px;
            --button-size: 44px;
            --card-padding: 20px;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* é•¿è¾ˆæ¨¡å¼å˜é‡ */
            --elder-font-base: 32px;
            --elder-font-title: 36px;
            --elder-font-subtitle: 34px;
            --elder-button-size: 80px;
            --elder-card-padding: 35px;
            --elder-border-radius: 20px;
        }
        .elder-mode {
            --font-size-base: var(--elder-font-base);
            --font-size-title: var(--elder-font-title);
            --font-size-subtitle: var(--elder-font-subtitle);
            --button-size: var(--elder-button-size);
            --card-padding: var(--elder-card-padding);
            --border-radius: var(--elder-border-radius);
            --shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
        }
        body {
            background-color: var(--color-black);
            color: #fff;
            background-image: radial-gradient(circle at 70% 30%, rgba(255, 215, 0, 0.08) 0%, rgba(34, 139, 34, 0.05) 90%);
            min-height: 100vh;
            padding-bottom: 60px;
            transition: var(--transition);
        }

        /* å¤´éƒ¨å¯¼èˆªï¼ˆè¿”å›+æ¨¡å¼åˆ‡æ¢ï¼‰ */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 5%;
            border-bottom: 2px solid rgba(200, 16, 46, 0.3);
            position: relative;
            z-index: 10;
        }
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(200, 16, 46, 0.8);
            color: #fff;
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: var(--transition);
        }
        .back-btn:hover {
            background: var(--color-gold);
            color: var(--color-black);
            transform: scale(1.05);
        }
        .theme-switch {
            width: var(--button-size);
            height: var(--button-size);
            border: none;
            border-radius: 50%;
            background-color: rgba(200, 16, 46, 0.8);
            color: #fff;
            font-size: calc(var(--font-size-base) - 4px);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .theme-switch:hover {
            background-color: var(--color-gold);
            color: var(--color-black);
            transform: scale(1.05);
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-title {
            text-align: center;
            font-size: var(--font-size-title);
            color: var(--color-gold);
            margin: 30px 0;
            letter-spacing: 2px;
            position: relative;
            z-index: 5;
        }
        .page-subtitle {
            text-align: center;
            font-size: var(--font-size-base);
            color: var(--color-gray-light);
            margin-bottom: 40px;
            position: relative;
            z-index: 5;
            line-height: 1.6;
        }

        /* ç”Ÿè¾°ä¿¡æ¯å½•å…¥è¡¨å• */
        .fortune-form {
            width: 90%;
            max-width: 800px;
            margin: 0 auto 50px;
            padding: var(--card-padding);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(200, 16, 46, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--border-radius);
            position: relative;
            z-index: 5;
        }
        .form-title {
            font-size: var(--font-size-subtitle);
            color: var(--color-gold);
            margin-bottom: 25px;
            text-align: center;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            font-size: var(--font-size-base);
            color: var(--color-gray-light);
            margin-bottom: 8px;
        }
        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: var(--font-size-base);
            transition: var(--transition);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--color-gold);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .form-col {
            flex: 1;
        }
        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--color-red), var(--color-gold));
            color: var(--color-black);
            border: none;
            border-radius: 8px;
            font-size: var(--font-size-base);
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }
        .calculate-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }

        /* è¿åŠ¿ç»“æœå¡ç‰‡ï¼ˆé»˜è®¤éšè—ï¼‰ */
        .fortune-result {
            width: 90%;
            max-width: 800px;
            margin: 0 auto 50px;
            padding: var(--card-padding);
            background: linear-gradient(135deg, rgba(200, 16, 46, 0.15), rgba(255, 215, 0, 0.08));
            border: 1px solid rgba(200, 16, 46, 0.3);
            border-radius: var(--border-radius);
            position: relative;
            z-index: 5;
            display: none;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }
        .result-title {
            font-size: var(--font-size-subtitle);
            color: var(--color-gold);
        }
        .result-actions {
            display: flex;
            gap: 10px;
        }
        .save-result-btn, .share-result-btn {
            background: rgba(255, 215, 0, 0.2);
            color: var(--color-gold);
            border: 1px solid var(--color-gold);
            border-radius: 50px;
            padding: 5px 15px;
            font-size: calc(var(--font-size-base) - 2px);
            cursor: pointer;
            transition: var(--transition);
        }
        .save-result-btn:hover, .share-result-btn:hover {
            background: var(--color-gold);
            color: var(--color-black);
        }

        /* è¿åŠ¿è¶‹åŠ¿å›¾ */
        .fortune-chart {
            width: 100%;
            height: 250px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 8px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .chart-title {
            text-align: center;
            font-size: var(--font-size-base);
            color: var(--color-gold);
            padding: 10px 0;
        }
        #fortune-chart-canvas {
            width: 100%;
            height: calc(100% - 40px);
        }

        /* è¿åŠ¿ç»´åº¦å¡ç‰‡ */
        .fortune-dimensions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dimension-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        .dimension-title {
            font-size: var(--font-size-base);
            color: var(--color-gold);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dimension-score {
            background: var(--color-red);
            padding: 2px 8px;
            border-radius: 50px;
            font-size: calc(var(--font-size-base) - 4px);
        }
        .dimension-desc {
            font-size: calc(var(--font-size-base) - 2px);
            color: var(--color-gray-light);
            line-height: 1.6;
        }

        /* è¯¦ç»†è§£è¯»ä¸å¼€è¿å»ºè®® */
        .fortune-details {
            margin-bottom: 25px;
        }
        .detail-title {
            font-size: var(--font-size-base);
            color: var(--color-red);
            font-weight: bold;
            margin-bottom: 15px;
        }
        .detail-content {
            font-size: var(--font-size-base);
            color: var(--color-gray-light);
            line-height: 1.8;
        }
        .luck-tips {
            background: rgba(255, 215, 0, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .luck-tips-title {
            color: var(--color-gold);
            font-weight: bold;
            margin-bottom: 15px;
            font-size: var(--font-size-base);
        }
        .luck-tips-list {
            list-style: none;
            padding-left: 20px;
        }
        .luck-tips-list li {
            margin-bottom: 10px;
            position: relative;
        }
        .luck-tips-list li::before {
            content: 'âœ¨';
            position: absolute;
            left: -20px;
            top: 0;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .fortune-dimensions {
                grid-template-columns: 1fr;
            }
            .fortune-chart {
                height: 200px;
            }
            .result-actions {
                flex-direction: column;
                gap: 5px;
            }
            .save-result-btn, .share-result-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header>
        <button class="back-btn" onclick="window.location.href='../index.html'">
            â† è¿”å›é¦–é¡µ
        </button>
        <button class="theme-switch" id="themeSwitch">é•¿è¾ˆ</button>
    </header>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <h1 class="page-title">ä»Šæ—¥è¿åŠ¿ Â· ç”Ÿè¾°å…«å­—æµ‹ç®—</h1>
    <p class="page-subtitle">è¾“å…¥æ‚¨çš„ç”Ÿè¾°ä¿¡æ¯ï¼Œç²¾å‡†æµ‹ç®—ä»Šæ—¥è¿åŠ¿<br>ç»“åˆäº”è¡Œå…«å¦ï¼Œç»™å‡ºä¸“å±å¼€è¿å»ºè®®</p>

    <!-- ç”Ÿè¾°ä¿¡æ¯å½•å…¥è¡¨å• -->
    <div class="fortune-form">
        <h3 class="form-title">è¯·è¾“å…¥æ‚¨çš„ç”Ÿè¾°ä¿¡æ¯</h3>
        <div class="form-group">
            <label class="form-label">å§“åï¼ˆé€‰å¡«ï¼‰</label>
            <input type="text" class="form-input" id="userName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
        </div>
        <div class="form-row">
            <div class="form-col">
                <label class="form-label">å‡ºç”Ÿæ—¥æœŸ</label>
                <input type="date" class="form-input" id="birthDate" required>
            </div>
            <div class="form-col">
                <label class="form-label">å‡ºç”Ÿæ—¶è¾°</label>
                <select class="form-input" id="birthHour" required>
                    <option value="">è¯·é€‰æ‹©æ—¶è¾°</option>
                    <option value="23-01">å­æ—¶ (23:00-01:00)</option>
                    <option value="01-03">ä¸‘æ—¶ (01:00-03:00)</option>
                    <option value="03-05">å¯…æ—¶ (03:00-05:00)</option>
                    <option value="05-07">å¯æ—¶ (05:00-07:00)</option>
                    <option value="07-09">è¾°æ—¶ (07:00-09:00)</option>
                    <option value="09-11">å·³æ—¶ (09:00-11:00)</option>
                    <option value="11-13">åˆæ—¶ (11:00-13:00)</option>
                    <option value="13-15">æœªæ—¶ (13:00-15:00)</option>
                    <option value="15-17">ç”³æ—¶ (15:00-17:00)</option>
                    <option value="17-19">é…‰æ—¶ (17:00-19:00)</option>
                    <option value="19-21">æˆŒæ—¶ (19:00-21:00)</option>
                    <option value="21-23">äº¥æ—¶ (21:00-23:00)</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">æ€§åˆ«</label>
            <div style="display: flex; gap: 20px;">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="radio" name="gender" value="male" checked style="width: 20px; height: 20px;"> ç”·
                </label>
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="radio" name="gender" value="female" style="width: 20px; height: 20px;"> å¥³
                </label>
            </div>
        </div>
        <button class="calculate-btn" onclick="calculateFortune()">ğŸ§® æµ‹ç®—ä»Šæ—¥è¿åŠ¿</button>
    </div>

    <!-- è¿åŠ¿ç»“æœå¡ç‰‡ -->
    <div class="fortune-result" id="fortuneResult">
        <div class="result-header">
            <div class="result-title" id="resultUserName">ä»Šæ—¥è¿åŠ¿æµ‹ç®—ç»“æœ</div>
            <div class="result-actions">
                <button class="save-result-btn" onclick="saveFortuneResult()">ä¿å­˜ç»“æœ</button>
                <button class="share-result-btn" onclick="shareFortuneResult()">åˆ†äº«ç»“æœ</button>
            </div>
        </div>

        <!-- è¿åŠ¿è¶‹åŠ¿å›¾ -->
        <div class="fortune-chart">
            <div class="chart-title">ä»Šæ—¥å„æ—¶æ®µè¿åŠ¿è¶‹åŠ¿</div>
            <canvas id="fortune-chart-canvas"></canvas>
        </div>

        <!-- è¿åŠ¿ç»´åº¦å¡ç‰‡ -->
        <div class="fortune-dimensions" id="fortuneDimensions">
            <!-- åŠ¨æ€ç”Ÿæˆç»´åº¦å¡ç‰‡ -->
        </div>

        <!-- è¯¦ç»†è§£è¯» -->
        <div class="fortune-details">
            <div class="detail-title">å…«å­—å‘½ç†è§£è¯»</div>
            <div class="detail-content" id="fortuneAnalysis">
                <!-- åŠ¨æ€å¡«å……è§£è¯»å†…å®¹ -->
            </div>
        </div>

        <!-- å¼€è¿å»ºè®® -->
        <div class="luck-tips">
            <div class="luck-tips-title">ä»Šæ—¥å¼€è¿å»ºè®®</div>
            <ul class="luck-tips-list" id="luckTips">
                <!-- åŠ¨æ€å¡«å……å¼€è¿å»ºè®® -->
            </ul>
        </div>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="../js/theme-utils.js"></script>
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            // åˆå§‹åŒ–æ¨¡å¼åˆ‡æ¢
            initThemeSwitch();
            
            // é»˜è®¤è®¾ç½®å‡ºç”Ÿæ—¥æœŸä¸º1990-01-01ï¼ˆç¤ºä¾‹ï¼‰
            document.getElementById('birthDate').value = '1990-01-01';
        });

        // æµ‹ç®—ä»Šæ—¥è¿åŠ¿æ ¸å¿ƒå‡½æ•°
        function calculateFortune() {
            // è·å–è¡¨å•æ•°æ®
            const userName = document.getElementById('userName').value || 'æœ‰ç¼˜äºº';
            const birthDate = document.getElementById('birthDate').value;
            const birthHour = document.getElementById('birthHour').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;

            // è¡¨å•éªŒè¯
            if (!birthDate) {
                alert('è¯·è¾“å…¥å‡ºç”Ÿæ—¥æœŸï¼');
                return;
            }
            if (!birthHour) {
                alert('è¯·é€‰æ‹©å‡ºç”Ÿæ—¶è¾°ï¼');
                return;
            }

            // ç”Ÿæˆéšæœºè¿åŠ¿æ•°æ®ï¼ˆæ¨¡æ‹Ÿæµ‹ç®—ï¼‰
            const fortuneData = generateFortuneData(userName, birthDate, birthHour, gender);
            
            // æ˜¾ç¤ºç»“æœå¡ç‰‡
            const resultCard = document.getElementById('fortuneResult');
            resultCard.style.display = 'block';
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('resultUserName').textContent = `${userName}çš„ä»Šæ—¥è¿åŠ¿æµ‹ç®—ç»“æœ`;
            
            // ç»˜åˆ¶è¿åŠ¿è¶‹åŠ¿å›¾
            drawFortuneChart(fortuneData.trend);
            
            // ç”Ÿæˆç»´åº¦å¡ç‰‡
            generateDimensionCards(fortuneData.dimensions);
            
            // å¡«å……è¯¦ç»†è§£è¯»
            document.getElementById('fortuneAnalysis').innerHTML = fortuneData.analysis;
            
            // å¡«å……å¼€è¿å»ºè®®
            document.getElementById('luckTips').innerHTML = fortuneData.luckTips.map(tip => `<li>${tip}</li>`).join('');
            
            // ä¿å­˜è¿åŠ¿æ•°æ®ä¾›åç»­ä½¿ç”¨
            window.currentFortuneData = fortuneData;
            window.currentFortuneUserInfo = {
                name: userName,
                birthDate: birthDate,
                birthHour: birthHour,
                gender: gender
            };
        }

        // ç”Ÿæˆéšæœºè¿åŠ¿æ•°æ®ï¼ˆæ ¸å¿ƒæµ‹ç®—é€»è¾‘æ¨¡æ‹Ÿï¼‰
        function generateFortuneData(name, birthDate, birthHour, gender) {
            // è¿åŠ¿ç»´åº¦å®šä¹‰
            const dimensions = [
                { name: 'è´¢è¿', key: 'wealth', score: Math.floor(Math.random() * 40) + 60 },
                { name: 'äº‹ä¸šè¿', key: 'career', score: Math.floor(Math.random() * 40) + 60 },
                { name: 'å¥åº·è¿', key: 'health', score: Math.floor(Math.random() * 40) + 60 },
                { name: 'æ„Ÿæƒ…è¿', key: 'love', score: Math.floor(Math.random() * 40) + 60 },
                { name: 'è´µäººè¿', key: 'noble', score: Math.floor(Math.random() * 40) + 60 },
                { name: 'å­¦ä¸šè¿', key: 'study', score: Math.floor(Math.random() * 40) + 60 }
            ];

            // ç”Ÿæˆæ—¶æ®µè¿åŠ¿è¶‹åŠ¿
            const timePeriods = ['å‡Œæ™¨', 'ä¸Šåˆ', 'ä¸­åˆ', 'ä¸‹åˆ', 'æ™šä¸Š', 'æ·±å¤œ'];
            const trend = timePeriods.map(period => ({
                period: period,
                score: Math.floor(Math.random() * 30) + 70
            }));

            // å…«å­—å‘½ç†è§£è¯»ï¼ˆæ ¹æ®éšæœºåˆ†æ•°ç”Ÿæˆï¼‰
            const totalScore = dimensions.reduce((sum, dim) => sum + dim.score, 0) / dimensions.length;
            let analysis = '';
            
            if (totalScore >= 90) {
                analysis = `${name}æ‚¨å¥½ï¼æ ¹æ®æ‚¨çš„ç”Ÿè¾°å…«å­—æµ‹ç®—ï¼Œä»Šæ—¥æ‚¨çš„æ•´ä½“è¿åŠ¿æä½³ï¼ˆ${totalScore.toFixed(1)}åˆ†ï¼‰ã€‚å‘½å®«å¾—è´µäººæ˜Ÿç…§ä¸´ï¼Œäº”è¡Œè°ƒå’Œï¼Œè¯¸äº‹é¡ºé‚ã€‚æ‚¨çš„å…«å­—ä¸­${gender === 'male' ? 'ä¹¾é€ ' : 'å¤é€ '}ä¸º${getRandomBazi()}ï¼Œä»Šæ—¥å¤©å¹²åœ°æ”¯ä¸º${getTodayGanZhi()}ï¼Œç›¸ç”Ÿç›¸åˆï¼Œæ˜¯éš¾å¾—çš„å‰æ—¥ã€‚é€‚åˆå¼€å±•é‡è¦é¡¹ç›®ã€æ´½è°ˆåˆä½œã€æŠ•èµ„ç†è´¢ï¼ŒæˆåŠŸæ¦‚ç‡æé«˜ã€‚æ„Ÿæƒ…æ–¹é¢ä¹Ÿæœ‰æ„å¤–æƒŠå–œï¼Œå•èº«è€…æœ‰é‚‚é€…è‰¯ç¼˜çš„æœºä¼šï¼Œå·²å©šè€…å®¶åº­å’Œç¦ã€‚å¥åº·æ–¹é¢çŠ¶æ€è‰¯å¥½ï¼Œåªéœ€æ³¨æ„åŠ³é€¸ç»“åˆå³å¯ã€‚`;
            } else if (totalScore >= 80) {
                analysis = `${name}æ‚¨å¥½ï¼æ ¹æ®æ‚¨çš„ç”Ÿè¾°å…«å­—æµ‹ç®—ï¼Œä»Šæ—¥æ‚¨çš„æ•´ä½“è¿åŠ¿è‰¯å¥½ï¼ˆ${totalScore.toFixed(1)}åˆ†ï¼‰ã€‚å‘½å®«æœ‰å‰æ˜Ÿç›¸åŠ©ï¼Œäº”è¡ŒåŸºæœ¬è°ƒå’Œï¼Œå¤§éƒ¨åˆ†äº‹æƒ…éƒ½èƒ½é¡ºåˆ©è¿›è¡Œã€‚æ‚¨çš„å…«å­—ä¸­${gender === 'male' ? 'ä¹¾é€ ' : 'å¤é€ '}ä¸º${getRandomBazi()}ï¼Œä»Šæ—¥å¤©å¹²åœ°æ”¯ä¸º${getTodayGanZhi()}ï¼Œè™½æœ‰å°å†²ä½†æ— å¤§ç¢ã€‚äº‹ä¸šä¸Šæœ‰æ™‹å‡æœºä¼šï¼Œè´¢è¿å¹³ç¨³ä¸Šå‡ï¼Œé€‚åˆç¨³å¥æŠ•èµ„ã€‚æ„Ÿæƒ…è¿å¹³é¡ºï¼Œé€‚åˆä¸ä¼´ä¾£æ²Ÿé€šäº¤æµã€‚å¥åº·æ–¹é¢éœ€æ³¨æ„${totalScore > 85 ? 'é¥®é£Ÿæ¸…æ·¡' : 'ä½œæ¯è§„å¾‹'}ã€‚`;
            } else if (totalScore >= 70) {
                analysis = `${name}æ‚¨å¥½ï¼æ ¹æ®æ‚¨çš„ç”Ÿè¾°å…«å­—æµ‹ç®—ï¼Œä»Šæ—¥æ‚¨çš„æ•´ä½“è¿åŠ¿ä¸€èˆ¬ï¼ˆ${totalScore.toFixed(1)}åˆ†ï¼‰ã€‚å‘½å®«æœ‰å°ç…å¹²æ‰°ï¼Œäº”è¡Œç•¥æœ‰å¤±è¡¡ï¼Œéœ€è°¨æ…è¡Œäº‹ã€‚æ‚¨çš„å…«å­—ä¸­${gender === 'male' ? 'ä¹¾é€ ' : 'å¤é€ '}ä¸º${getRandomBazi()}ï¼Œä»Šæ—¥å¤©å¹²åœ°æ”¯ä¸º${getTodayGanZhi()}ï¼Œæœ‰ç›¸å…‹ä¹‹è±¡ã€‚äº‹ä¸šä¸Šæ˜“é‡å°äººï¼Œå»ºè®®ä½è°ƒè¡Œäº‹ï¼›è´¢è¿æ™®é€šï¼Œä¸å®œå¤§é¢æŠ•èµ„ï¼›æ„Ÿæƒ…è¿å¹³æ·¡ï¼Œé¿å…äº‰åµã€‚å¥åº·æ–¹é¢éœ€æ³¨æ„${totalScore > 75 ? 'é¢ˆæ¤ä¿æŠ¤' : 'è‚ èƒƒè°ƒç†'}ã€‚`;
            } else {
                analysis = `${name}æ‚¨å¥½ï¼æ ¹æ®æ‚¨çš„ç”Ÿè¾°å…«å­—æµ‹ç®—ï¼Œä»Šæ—¥æ‚¨çš„æ•´ä½“è¿åŠ¿è¾ƒå·®ï¼ˆ${totalScore.toFixed(1)}åˆ†ï¼‰ã€‚å‘½å®«çŠ¯ç…ï¼Œäº”è¡Œå¤±è°ƒï¼Œéœ€å¤šåŠ å°å¿ƒã€‚æ‚¨çš„å…«å­—ä¸­${gender === 'male' ? 'ä¹¾é€ ' : 'å¤é€ '}ä¸º${getRandomBazi()}ï¼Œä»Šæ—¥å¤©å¹²åœ°æ”¯ä¸º${getTodayGanZhi()}ï¼Œç›¸å†²ç›¸å…‹ï¼Œè¯¸äº‹ä¸å®œã€‚å»ºè®®ä»Šæ—¥ä»¥å®ˆä¸ºä¸»ï¼Œé¿å…é‡å¤§å†³ç­–å’ŒæŠ•èµ„ï¼›æ³¨æ„äººé™…å…³ç³»ï¼Œé¿å…å£èˆŒä¹‹äº‰ï¼›å¥åº·æ–¹é¢éœ€ç‰¹åˆ«æ³¨æ„${totalScore > 65 ? 'å¿ƒè¡€ç®¡' : 'å‘¼å¸é“'}é—®é¢˜ï¼Œä¸å®œè¿‡åº¦åŠ³ç´¯ã€‚`;
            }

            // å¼€è¿å»ºè®®ï¼ˆæ ¹æ®åˆ†æ•°åŠ¨æ€ç”Ÿæˆï¼‰
            const luckTips = [];
            if (totalScore >= 90) {
                luckTips.push('ä»Šæ—¥å®œç©¿çº¢è‰²/é‡‘è‰²è¡£ç‰©ï¼Œå¢å¼ºè¿åŠ¿');
                luckTips.push('å¯ä½©æˆ´é»„é‡‘é¥°å“ï¼Œæå‡è´¢è¿');
                luckTips.push('ä¸Šåˆ9-11ç‚¹å¼€å±•é‡è¦äº‹åŠ¡ï¼ŒæˆåŠŸç‡æœ€é«˜');
                luckTips.push('å‘ä¸œæ–¹å‡ºè¡Œï¼Œé‡è´µäººç›¸åŠ©');
                luckTips.push('å¤šé£Ÿçº¢è‰²æ°´æœï¼Œå¢å¼ºç«æ°”åŠ©è¿');
            } else if (totalScore >= 80) {
                luckTips.push('ä»Šæ—¥å®œç©¿é»„è‰²/æ£•è‰²è¡£ç‰©ï¼Œç¨³å®šæ°”åœº');
                luckTips.push('ä½©æˆ´ç‰çŸ³é¥°å“ï¼Œè°ƒå’Œäº”è¡Œ');
                luckTips.push('é¿å…ä¸‹åˆ3-5ç‚¹åšé‡è¦å†³ç­–');
                luckTips.push('å®¶ä¸­æ‘†æ”¾ç»¿æ¤ï¼Œå¢å¼ºç”Ÿæ°”');
                luckTips.push('ä¿æŒå¿ƒæ€å¹³å’Œï¼Œé¿å…æ€¥èº');
            } else if (totalScore >= 70) {
                luckTips.push('ä»Šæ—¥å®œç©¿é»‘è‰²/è“è‰²è¡£ç‰©ï¼ŒåŒ–è§£ç…æ°”');
                luckTips.push('ä½©æˆ´é»‘æ›œçŸ³é¥°å“ï¼Œè¾Ÿé‚ªæŒ¡ç…');
                luckTips.push('é¿å…å¤§é¢æ¶ˆè´¹å’ŒæŠ•èµ„');
                luckTips.push('å®¶ä¸­ç‚¹æª€é¦™ï¼Œå‡€åŒ–æ°”åœº');
                luckTips.push('å¤šå–æ¸©æ°´ï¼Œè°ƒå’Œèº«ä½“');
            } else {
                luckTips.push('ä»Šæ—¥å®œç©¿ç™½è‰²/é“¶è‰²è¡£ç‰©ï¼ŒåŒ–è§£ä¸åˆ©');
                luckTips.push('ä½©æˆ´ç™½æ°´æ™¶é¥°å“ï¼Œå‡€åŒ–è´Ÿèƒ½é‡');
                luckTips.push('å°½é‡é¿å…å¤–å‡ºå’Œç¤¾äº¤æ´»åŠ¨');
                luckTips.push('å®¶ä¸­æ‘†æ”¾äº”å¸é’±ï¼ŒåŒ–è§£ç…æ°”');
                luckTips.push('æ—©ä¼‘æ¯ï¼Œä¿è¯å……è¶³ç¡çœ ');
            }

            return {
                dimensions: dimensions,
                trend: trend,
                analysis: analysis,
                luckTips: luckTips,
                totalScore: totalScore
            };
        }

        // ç»˜åˆ¶è¿åŠ¿è¶‹åŠ¿å›¾
        function drawFortuneChart(trendData) {
            const canvas = document.getElementById('fortune-chart-canvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            // é€‚é…é«˜æ¸…å±
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, rect.width, rect.height);

            // å›¾è¡¨å‚æ•°
            const padding = 30;
            const width = rect.width - 2 * padding;
            const height = rect.height - 2 * padding;
            const pointCount = trendData.length;
            const pointWidth = width / (pointCount - 1);

            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            
            // æ°´å¹³ç½‘æ ¼çº¿
            for (let i = 0; i <= 5; i++) {
                const y = padding + i * height / 5;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + width, y);
                ctx.stroke();
                
                // æ•°å€¼æ ‡ç­¾
                const value = 100 - i * 20;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '12px SimHei';
                ctx.textAlign = 'right';
                ctx.fillText(value, padding - 5, y + 4);
            }

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = 'rgba(255, 215, 0, 0.8)';
            ctx.lineWidth = 2;
            
            // æ¨ªè½´
            ctx.beginPath();
            ctx.moveTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // çºµè½´
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.stroke();

            // ç»˜åˆ¶è¶‹åŠ¿çº¿
            ctx.beginPath();
            trendData.forEach((item, index) => {
                const x = padding + index * pointWidth;
                const y = padding + height - (item.score / 100) * height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                // ç»˜åˆ¶æ•°æ®ç‚¹
                ctx.fillStyle = item.score >= 90 ? '#c8102e' : item.score >= 80 ? '#ffd700' : '#228b22';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // æ—¶æ®µæ ‡ç­¾
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '14px SimHei';
                ctx.textAlign = 'center';
                ctx.fillText(item.period, x, padding + height + 20);
                
                // åˆ†æ•°æ ‡ç­¾
                ctx.fillStyle = item.score >= 90 ? '#c8102e' : item.score >= 80 ? '#ffd700' : '#228b22';
                ctx.fillText(item.score, x, y - 10);
            });

            // ç»˜åˆ¶è¶‹åŠ¿çº¿
            ctx.strokeStyle = 'rgba(255, 215, 0, 0.8)';
            ctx.lineWidth = 3;
            ctx.stroke();

            // å¡«å……åŒºåŸŸ
            ctx.fillStyle = 'rgba(200, 16, 46, 0.2)';
            ctx.lineTo(padding + (pointCount - 1) * pointWidth, padding + height);
            ctx.lineTo(padding, padding + height);
            ctx.closePath();
            ctx.fill();
        }

        // ç”Ÿæˆç»´åº¦å¡ç‰‡
        function generateDimensionCards(dimensions) {
            const container = document.getElementById('fortuneDimensions');
            container.innerHTML = '';
            
            dimensions.forEach(dim => {
                // ç¡®å®šåˆ†æ•°é¢œè‰²
                let scoreColor = '';
                if (dim.score >= 90) scoreColor = '#c8102e'; // çº¢
                else if (dim.score >= 80) scoreColor = '#ffd700'; // é‡‘
                else if (dim.score >= 70) scoreColor = '#228b22'; // ç»¿
                else scoreColor = '#1e90ff'; // è“

                // ç”Ÿæˆç»´åº¦æè¿°
                let desc = '';
                switch(dim.key) {
                    case 'wealth':
                        desc = dim.score >= 90 ? 'è´¢è¿äº¨é€šï¼Œåè´¢æ­£è´¢çš†æ—ºï¼Œé€‚åˆæŠ•èµ„ç†è´¢' :
                               dim.score >= 80 ? 'è´¢è¿å¹³ç¨³ï¼Œå°æœ‰è¿›è´¦ï¼Œå¯ç¨³å¥æŠ•èµ„' :
                               dim.score >= 70 ? 'è´¢è¿æ™®é€šï¼Œå®œå®ˆä¸å®œæ”»ï¼Œé¿å…å¤§é¢æ”¯å‡º' :
                               'è´¢è¿ä½è¿·ï¼Œæ˜“æœ‰ç ´è´¢é£é™©ï¼Œè°¨æ…æ¶ˆè´¹';
                        break;
                    case 'career':
                        desc = dim.score >= 90 ? 'äº‹ä¸šè¿æä½³ï¼Œæœ‰æ™‹å‡æœºä¼šï¼Œè´µäººç›¸åŠ©' :
                               dim.score >= 80 ? 'äº‹ä¸šè¿è‰¯å¥½ï¼Œå·¥ä½œé¡ºåˆ©ï¼Œå°æœ‰æˆå°±' :
                               dim.score >= 70 ? 'äº‹ä¸šè¿ä¸€èˆ¬ï¼Œæ˜“é‡å°äººï¼Œéœ€ä½è°ƒè¡Œäº‹' :
                               'äº‹ä¸šè¿ä¸ä½³ï¼Œæ˜“æœ‰æŒ«æŠ˜ï¼Œä»¥å®ˆä¸ºä¸»';
                        break;
                    case 'health':
                        desc = dim.score >= 90 ? 'å¥åº·è¿æä½³ï¼Œç²¾åŠ›å……æ²›ï¼Œæ— ç—…æ— ç¾' :
                               dim.score >= 80 ? 'å¥åº·è¿è‰¯å¥½ï¼Œèº«ä½“çŠ¶æ€ä½³ï¼Œåªéœ€æ—¥å¸¸ä¿å…»' :
                               dim.score >= 70 ? 'å¥åº·è¿ä¸€èˆ¬ï¼Œéœ€æ³¨æ„'+(dim.score>75?'é¢ˆæ¤':'è‚ èƒƒ')+'é—®é¢˜' :
                               'å¥åº·è¿è¾ƒå·®ï¼Œæ˜“ç”Ÿç—…ç—›ï¼Œéœ€ç‰¹åˆ«æ³¨æ„ä¼‘æ¯';
                        break;
                    case 'love':
                        desc = dim.score >= 90 ? 'æ„Ÿæƒ…è¿æä½³ï¼Œå•èº«è€…é‡è‰¯ç¼˜ï¼Œå·²å©šè€…æ„Ÿæƒ…å‡æ¸©' :
                               dim.score >= 80 ? 'æ„Ÿæƒ…è¿è‰¯å¥½ï¼Œæ²Ÿé€šé¡ºç•…ï¼Œå…³ç³»å’Œè°' :
                               dim.score >= 70 ? 'æ„Ÿæƒ…è¿å¹³æ·¡ï¼Œé¿å…äº‰åµï¼Œå¤šäº›åŒ…å®¹' :
                               'æ„Ÿæƒ…è¿ä¸ä½³ï¼Œæ˜“æœ‰çŸ›ç›¾ï¼Œä¿æŒå†·é™';
                        break;
                    case 'noble':
                        desc = dim.score >= 90 ? 'è´µäººè¿çˆ†æ£šï¼Œå¤„å¤„é‡è´µäººï¼Œäº‹åŠåŠŸå€' :
                               dim.score >= 80 ? 'è´µäººè¿è‰¯å¥½ï¼Œæœ‰æœ‹å‹ç›¸åŠ©ï¼Œè§£å†³å›°éš¾' :
                               dim.score >= 70 ? 'è´µäººè¿ä¸€èˆ¬ï¼Œéœ€ä¸»åŠ¨å¯»æ±‚å¸®åŠ©' :
                               'è´µäººè¿ä¸ä½³ï¼Œå‡¡äº‹é è‡ªå·±ï¼Œé¿å…ä¾èµ–ä»–äºº';
                        break;
                    case 'study':
                        desc = dim.score >= 90 ? 'å­¦ä¸šè¿æä½³ï¼Œæ€ç»´æ•æ·ï¼Œå­¦ä¹ æ•ˆç‡é«˜' :
                               dim.score >= 80 ? 'å­¦ä¸šè¿è‰¯å¥½ï¼Œè®°å¿†åŠ›ä½³ï¼Œé€‚åˆå­¦ä¹ æ–°çŸ¥è¯†' :
                               dim.score >= 70 ? 'å­¦ä¸šè¿ä¸€èˆ¬ï¼Œæ³¨æ„åŠ›ä¸é›†ä¸­ï¼Œéœ€è°ƒæ•´çŠ¶æ€' :
                               'å­¦ä¸šè¿ä¸ä½³ï¼Œæ€ç»´è¿Ÿé’ï¼Œä¸å®œé‡è¦è€ƒè¯•';
                        break;
                }

                // åˆ›å»ºå¡ç‰‡å…ƒç´ 
                const card = document.createElement('div');
                card.className = 'dimension-card';
                card.innerHTML = `
                    <div class="dimension-title">
                        ${dim.name}
                        <span class="dimension-score" style="background-color: ${scoreColor}">${dim.score}åˆ†</span>
                    </div>
                    <div class="dimension-desc">${desc}</div>
                `;
                
                container.appendChild(card);
            });
        }

        // ä¿å­˜è¿åŠ¿ç»“æœ
        function saveFortuneResult() {
            if (!window.currentFortuneData || !window.currentFortuneUserInfo) {
                alert('è¯·å…ˆå®Œæˆè¿åŠ¿æµ‹ç®—åå†ä¿å­˜ï¼');
                return;
            }

            // æ„é€ ä¿å­˜æ•°æ®
            const resultData = {
                userInfo: window.currentFortuneUserInfo,
                totalScore: window.currentFortuneData.totalScore,
                dimensions: window.currentFortuneData.dimensions,
                analysis: window.currentFortuneData.analysis,
                luckTips: window.currentFortuneData.luckTips,
                time: new Date().toLocaleString()
            };

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const fortuneResults = JSON.parse(localStorage.getItem('fortuneResults') || '[]');
            fortuneResults.push(resultData);
            // åªä¿ç•™æœ€è¿‘5æ¡ç»“æœ
            const latestResults = fortuneResults.slice(-5);
            localStorage.setItem('fortuneResults', JSON.stringify(latestResults));

            alert(`âœ… ${window.currentFortuneUserInfo.name}çš„ä»Šæ—¥è¿åŠ¿å·²ä¿å­˜ï¼å¯åœ¨"æˆ‘çš„"é¡µé¢æŸ¥çœ‹`);
        }

        // åˆ†äº«è¿åŠ¿ç»“æœ
        function shareFortuneResult() {
            if (!window.currentFortuneData || !window.currentFortuneUserInfo) {
                alert('è¯·å…ˆå®Œæˆè¿åŠ¿æµ‹ç®—åå†åˆ†äº«ï¼');
                return;
            }

            // æ„é€ åˆ†äº«æ–‡æœ¬
            const userName = window.currentFortuneUserInfo.name;
            const totalScore = window.currentFortuneData.totalScore.toFixed(1);
            const wealthScore = window.currentFortuneData.dimensions.find(d => d.key === 'wealth').score;
            const careerScore = window.currentFortuneData.dimensions.find(d => d.key === 'career').score;
            
            const shareText = `${userName}çš„ä»Šæ—¥è¿åŠ¿æŠ¥å‘Šï¼š
æ•´ä½“è¯„åˆ†ï¼š${totalScore}åˆ†
è´¢è¿ï¼š${wealthScore}åˆ† | äº‹ä¸šè¿ï¼š${careerScore}åˆ†

${window.currentFortuneData.analysis.substring(0, 150)}...

æ›´å¤šå¼€è¿å»ºè®®è¯·æŸ¥çœ‹èµ›åšç½—ç›˜å°ç¨‹åº`;

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(shareText).then(() => {
                alert('ğŸ“‹ è¿åŠ¿ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯åˆ†äº«åˆ°å¾®ä¿¡/æœ‹å‹åœˆç­‰å¹³å°');
            }).catch(() => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š\n' + shareText);
            });
        }

        // è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆéšæœºå…«å­—
        function getRandomBazi() {
            const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
            const diZhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
            
            const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
            
            return `${getRandom(tianGan)}${getRandom(diZhi)} ${getRandom(tianGan)}${getRandom(diZhi)} ${getRandom(tianGan)}${getRandom(diZhi)} ${getRandom(tianGan)}${getRandom(diZhi)}`;
        }

        // è¾…åŠ©å‡½æ•°ï¼šè·å–ä»Šæ—¥å¹²æ”¯
        function getTodayGanZhi() {
            const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
            const diZhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
            
            // ç®€å•æ¨¡æ‹Ÿä»Šæ—¥å¹²æ”¯ï¼ˆå®é™…éœ€æ ¹æ®ä¸‡å¹´å†è®¡ç®—ï¼‰
            const today = new Date();
            const ganIndex = today.getDate() % 10;
            const zhiIndex = today.getDate() % 12;
            
            return `${tianGan[ganIndex]}${diZhi[zhiIndex]}`;
        }
    </script>
</body>
</html>
