<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ Â· æˆ‘çš„æµ‹ç®—è®°å½• - å›½é£ç„æ˜“</title>
    <style>
        /* å…¨å±€å˜é‡ä¸åŸºç¡€æ ·å¼ï¼ˆä¿æŒé£æ ¼ç»Ÿä¸€ï¼‰ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "SimHei", "Microsoft YaHei", "PingFang SC", sans-serif;
        }
        :root {
            /* å›½é£ä¸»è‰²è°ƒ */
            --color-black: #0a0a0a; /* ç„é»‘ */
            --color-red: #c8102e; /* æœ±ç ‚çº¢ */
            --color-gold: #ffd700; /* éé‡‘ */
            --color-green: #228b22; /* é’é»›ç»¿ */
            --color-blue: #1e90ff; /* æ°´è“ */
            --color-gray-light: #e0e0e0; /* æµ…ç° */
            --color-gray-dark: #333; /* æ·±ç° */
            
            /* å¹´è½»æ¨¡å¼å˜é‡ */
            --font-size-base: 16px;
            --font-size-title: 20px;
            --font-size-subtitle: 18px;
            --button-size: 44px;
            --card-padding: 20px;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* é•¿è¾ˆæ¨¡å¼å˜é‡ */
            --elder-font-base: 32px;
            --elder-font-title: 36px;
            --elder-font-subtitle: 34px;
            --elder-button-size: 80px;
            --elder-card-padding: 35px;
            --elder-border-radius: 20px;
        }
        .elder-mode {
            --font-size-base: var(--elder-font-base);
            --font-size-title: var(--elder-font-title);
            --font-size-subtitle: var(--elder-font-subtitle);
            --button-size: var(--elder-button-size);
            --card-padding: var(--elder-card-padding);
            --border-radius: var(--elder-border-radius);
            --shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
        }
        body {
            background-color: var(--color-black);
            color: #fff;
            background-image: radial-gradient(circle at 50% 50%, rgba(34, 139, 34, 0.08) 0%, rgba(200, 16, 46, 0.05) 90%);
            min-height: 100vh;
            padding-bottom: 60px;
            transition: var(--transition);
        }

        /* å¤´éƒ¨å¯¼èˆªï¼ˆè¿”å›+æ¨¡å¼åˆ‡æ¢ï¼‰ */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 5%;
            border-bottom: 2px solid rgba(200, 16, 46, 0.3);
            position: relative;
            z-index: 10;
        }
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(200, 16, 46, 0.8);
            color: #fff;
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: var(--transition);
        }
        .back-btn:hover {
            background: var(--color-gold);
            color: var(--color-black);
            transform: scale(1.05);
        }
        .theme-switch {
            width: var(--button-size);
            height: var(--button-size);
            border: none;
            border-radius: 50%;
            background-color: rgba(200, 16, 46, 0.8);
            color: #fff;
            font-size: calc(var(--font-size-base) - 4px);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .theme-switch:hover {
            background-color: var(--color-gold);
            color: var(--color-black);
            transform: scale(1.05);
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-title {
            text-align: center;
            font-size: var(--font-size-title);
            color: var(--color-gold);
            margin: 30px 0;
            letter-spacing: 2px;
            position: relative;
            z-index: 5;
        }

        /* ä¸ªäººä¿¡æ¯å¡ç‰‡ */
        .profile-card {
            width: 90%;
            max-width: 800px;
            margin: 0 auto 50px;
            padding: var(--card-padding);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(200, 16, 46, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--border-radius);
            position: relative;
            z-index: 5;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .avatar-container {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--color-gold);
        }
        .avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: linear-gradient(135deg, var(--color-red), var(--color-gold));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #fff;
        }
        .profile-info {
            flex: 1;
        }
        .user-name {
            font-size: var(--font-size-subtitle);
            color: var(--color-gold);
            margin-bottom: 10px;
        }
        .user-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: var(--font-size-base);
            color: var(--color-red);
            font-weight: bold;
        }
        .stat-label {
            font-size: calc(var(--font-size-base) - 2px);
            color: var(--color-gray-light);
        }
        .edit-profile-btn {
            padding: 8px 20px;
            background: rgba(255, 215, 0, 0.2);
            color: var(--color-gold);
            border: 1px solid var(--color-gold);
            border-radius: 50px;
            font-size: calc(var(--font-size-base) - 2px);
            cursor: pointer;
            transition: var(--transition);
        }
        .edit-profile-btn:hover {
            background: var(--color-gold);
            color: var(--color-black);
        }

        /* æ ‡ç­¾é¡µåˆ‡æ¢ */
        .tabs-container {
            width: 90%;
            max-width: 800px;
            margin: 0 auto 30px;
            position: relative;
            z-index: 5;
        }
        .tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50px;
            padding: 5px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-size: var(--font-size-base);
            color: var(--color-gray-light);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
        }
        .tab.active {
            background: linear-gradient(135deg, var(--color-red), var(--color-gold));
            color: var(--color-black);
            font-weight: bold;
        }

        /* è®°å½•åˆ—è¡¨å®¹å™¨ */
        .records-container {
            width: 90%;
            max-width: 800px;
            margin: 0 auto 50px;
            position: relative;
            z-index: 5;
        }
        .record-empty {
            text-align: center;
            padding: 50px 0;
            color: var(--color-gray-light);
            font-size: var(--font-size-base);
        }
        .record-list {
            list-style: none;
        }
        .record-item {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(200, 16, 46, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--border-radius);
            padding: var(--card-padding);
            margin-bottom: 20px;
            transition: var(--transition);
        }
        .record-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--color-gold);
        }
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }
        .record-title {
            font-size: var(--font-size-base);
            color: var(--color-gold);
            font-weight: bold;
        }
        .record-time {
            font-size: calc(var(--font-size-base) - 2px);
            color: var(--color-gray-light);
        }
        .record-content {
            font-size: var(--font-size-base);
            color: var(--color-gray-light);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        .record-score {
            display: inline-block;
            padding: 5px 10px;
            background: var(--color-red);
            border-radius: 50px;
            font-size: calc(var(--font-size-base) - 2px);
            margin-bottom: 15px;
        }
        .record-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .record-btn {
            padding: 5px 15px;
            background: rgba(255, 215, 0, 0.2);
            color: var(--color-gold);
            border: 1px solid var(--color-gold);
            border-radius: 50px;
            font-size: calc(var(--font-size-base) - 4px);
            cursor: pointer;
            transition: var(--transition);
        }
        .record-btn:hover {
            background: var(--color-gold);
            color: var(--color-black);
        }

        /* è®¾ç½®åŒºåŸŸ */
        .settings-section {
            width: 90%;
            max-width: 800px;
            margin: 0 auto;
            padding: var(--card-padding);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(200, 16, 46, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--border-radius);
            position: relative;
            z-index: 5;
        }
        .settings-title {
            font-size: var(--font-size-subtitle);
            color: var(--color-gold);
            margin-bottom: 25px;
        }
        .settings-list {
            list-style: none;
        }
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }
        .settings-label {
            font-size: var(--font-size-base);
            color: var(--color-gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .settings-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-red);
            font-size: 20px;
        }
        .settings-action {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .settings-btn {
            padding: 8px 20px;
            background: rgba(200, 16, 46, 0.6);
            color: #fff;
            border: none;
            border-radius: 50px;
            font-size: calc(var(--font-size-base) - 2px);
            cursor: pointer;
            transition: var(--transition);
        }
        .settings-btn:hover {
            background: var(--color-gold);
            color: var(--color-black);
        }

        /* å¼€å…³ç»„ä»¶ */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--color-red);
        }
        input:checked + .slider:before {
            transform: translateX(30px);
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            .profile-card {
                flex-direction: column;
                text-align: center;
            }
            .user-stats {
                justify-content: center;
            }
            .record-actions {
                flex-direction: column;
            }
            .record-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header>
        <button class="back-btn" onclick="window.location.href='../index.html'">
            â† è¿”å›é¦–é¡µ
        </button>
        <button class="theme-switch" id="themeSwitch">é•¿è¾ˆ</button>
    </header>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <h1 class="page-title">ä¸ªäººä¸­å¿ƒ Â· æˆ‘çš„æµ‹ç®—è®°å½•</h1>

    <!-- ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
    <div class="profile-card">
        <div class="avatar-container">
            <div class="avatar" id="userAvatar">ç„</div>
        </div>
        <div class="profile-info">
            <div class="user-name" id="displayName">ç„æ˜“å±…å£«</div>
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-value" id="compassCount">0</div>
                    <div class="stat-label">ç½—ç›˜æµ‹ç®—</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="houseCount">0</div>
                    <div class="stat-label">å®¶å±…æµ‹ç®—</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="fortuneCount">0</div>
                    <div class="stat-label">è¿åŠ¿æµ‹ç®—</div>
                </div>
            </div>
            <button class="edit-profile-btn" onclick="editProfile()">ç¼–è¾‘ä¸ªäººä¿¡æ¯</button>
        </div>
    </div>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <div class="tabs-container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('all')">å…¨éƒ¨è®°å½•</div>
            <div class="tab" onclick="switchTab('compass')">ç½—ç›˜æµ‹ç®—</div>
            <div class="tab" onclick="switchTab('house')">å®¶å±…é£æ°´</div>
            <div class="tab" onclick="switchTab('fortune')">ä»Šæ—¥è¿åŠ¿</div>
        </div>
    </div>

    <!-- è®°å½•åˆ—è¡¨å®¹å™¨ -->
    <div class="records-container" id="recordsContainer">
        <div class="record-empty" id="emptyTip">
            ğŸ“œ æš‚æ— æµ‹ç®—è®°å½•<br>å¿«å»é¦–é¡µå¼€å§‹æ‚¨çš„é£æ°´æµ‹ç®—ä¹‹æ—…å§ï¼
        </div>
        <ul class="record-list" id="recordList">
            <!-- åŠ¨æ€ç”Ÿæˆè®°å½•åˆ—è¡¨ -->
        </ul>
    </div>

    <!-- è®¾ç½®åŒºåŸŸ -->
    <div class="settings-section">
        <h3 class="settings-title">ç³»ç»Ÿè®¾ç½®</h3>
        <ul class="settings-list">
            <li class="settings-item">
                <div class="settings-label">
                    <span class="settings-icon">ğŸ”Š</span>
                    è¯­éŸ³æ’­æŠ¥
                </div>
                <div class="settings-action">
                    <label class="switch">
                        <input type="checkbox" id="voiceSwitch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </li>
            <li class="settings-item">
                <div class="settings-label">
                    <span class="settings-icon">ğŸŒ™</span>
                    æ·±è‰²æ¨¡å¼
                </div>
                <div class="settings-action">
                    <label class="switch">
                        <input type="checkbox" id="darkModeSwitch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </li>
            <li class="settings-item">
                <div class="settings-label">
                    <span class="settings-icon">ğŸ§¹</span>
                    æ¸…é™¤æ‰€æœ‰è®°å½•
                </div>
                <div class="settings-action">
                    <button class="settings-btn" onclick="clearAllRecords()">æ¸…é™¤è®°å½•</button>
                </div>
            </li>
            <li class="settings-item">
                <div class="settings-label">
                    <span class="settings-icon">â„¹ï¸</span>
                    å…³äºæˆ‘ä»¬
                </div>
                <div class="settings-action">
                    <button class="settings-btn" onclick="showAbout()">å…³äº</button>
                </div>
            </li>
            <li class="settings-item">
                <div class="settings-label">
                    <span class="settings-icon">ğŸ“</span>
                    è”ç³»å®¢æœ
                </div>
                <div class="settings-action">
                    <button class="settings-btn" onclick="contactService()">å®¢æœ</button>
                </div>
            </li>
        </ul>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="../js/theme-utils.js"></script>
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            // åˆå§‹åŒ–æ¨¡å¼åˆ‡æ¢
            initThemeSwitch();
            // åŠ è½½ç”¨æˆ·ä¿¡æ¯
            loadUserInfo();
            // åŠ è½½æ‰€æœ‰è®°å½•
            loadAllRecords();
            // åˆå§‹åŒ–è®¾ç½®é¡¹
            initSettings();
        });

        // åŠ è½½ç”¨æˆ·ä¿¡æ¯
        function loadUserInfo() {
            // ä»æœ¬åœ°å­˜å‚¨è·å–ç”¨æˆ·ä¿¡æ¯
            const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{"name":"ç„æ˜“å±…å£«","avatar":"ç„"}');
            
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            document.getElementById('displayName').textContent = userInfo.name;
            document.getElementById('userAvatar').textContent = userInfo.avatar || userInfo.name.substring(0, 1);
            
            // ç»Ÿè®¡å„ç±»è®°å½•æ•°é‡
            const compassCount = JSON.parse(localStorage.getItem('fengshuiResults') || '[]').length;
            const houseCount = JSON.parse(localStorage.getItem('houseFengshuiResults') || '[]').length;
            const fortuneCount = JSON.parse(localStorage.getItem('fortuneResults') || '[]').length;
            
            document.getElementById('compassCount').textContent = compassCount;
            document.getElementById('houseCount').textContent = houseCount;
            document.getElementById('fortuneCount').textContent = fortuneCount;
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabType) {
            // æ›´æ–°æ ‡ç­¾æ ·å¼
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // æ‰¾åˆ°å½“å‰æ ‡ç­¾å¹¶æ¿€æ´»
            Array.from(tabs).forEach(tab => {
                if (tab.getAttribute('onclick').includes(tabType)) {
                    tab.classList.add('active');
                }
            });
            
            // åŠ è½½å¯¹åº”ç±»å‹çš„è®°å½•
            loadRecordsByType(tabType);
        }

        // åŠ è½½æ‰€æœ‰è®°å½•
        function loadAllRecords() {
            loadRecordsByType('all');
        }

        // æ ¹æ®ç±»å‹åŠ è½½è®°å½•
        function loadRecordsByType(type) {
            // è·å–æ‰€æœ‰è®°å½•
            const compassRecords = JSON.parse(localStorage.getItem('fengshuiResults') || '[]');
            const houseRecords = JSON.parse(localStorage.getItem('houseFengshuiResults') || '[]');
            const fortuneRecords = JSON.parse(localStorage.getItem('fortuneResults') || '[]');
            
            // åˆå¹¶å¹¶æ’åºæ‰€æœ‰è®°å½•
            let allRecords = [];
            
            // å¤„ç†ç½—ç›˜è®°å½•
            compassRecords.forEach(record => {
                allRecords.push({
                    type: 'compass',
                    title: 'ç½—ç›˜é£æ°´æµ‹ç®—',
                    time: record.time,
                    content: `æ–¹ä½è§’åº¦ï¼š${record.rotation}Â°<br>${record.content.substring(0, 100)}...`,
                    score: '',
                    data: record
                });
            });
            
            // å¤„ç†å®¶å±…é£æ°´è®°å½•
            houseRecords.forEach(record => {
                allRecords.push({
                    type: 'house',
                    title: `${record.area}é£æ°´æµ‹ç®—`,
                    time: record.time,
                    content: `é£æ°´è¯„åˆ†ï¼š${record.score}åˆ†<br>${record.content.substring(0, 100)}...`,
                    score: record.score + 'åˆ†',
                    data: record
                });
            });
            
            // å¤„ç†è¿åŠ¿è®°å½•
            fortuneRecords.forEach(record => {
                allRecords.push({
                    type: 'fortune',
                    title: `${record.userInfo.name || 'æœ‰ç¼˜äºº'}çš„ä»Šæ—¥è¿åŠ¿`,
                    time: record.time,
                    content: `æ•´ä½“è¯„åˆ†ï¼š${record.totalScore.toFixed(1)}åˆ†<br>${record.analysis.substring(0, 100)}...`,
                    score: record.totalScore.toFixed(1) + 'åˆ†',
                    data: record
                });
            });
            
            // æŒ‰æ—¶é—´å€’åºæ’åº
            allRecords.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            // æ ¹æ®ç±»å‹ç­›é€‰
            let filteredRecords = allRecords;
            if (type !== 'all') {
                filteredRecords = allRecords.filter(record => record.type === type);
            }
            
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            const recordList = document.getElementById('recordList');
            const emptyTip = document.getElementById('emptyTip');
            
            if (filteredRecords.length === 0) {
                // æ˜¾ç¤ºç©ºæç¤º
                emptyTip.style.display = 'block';
                recordList.innerHTML = '';
            } else {
                // éšè—ç©ºæç¤º
                emptyTip.style.display = 'none';
                
                // ç”Ÿæˆè®°å½•åˆ—è¡¨
                recordList.innerHTML = '';
                filteredRecords.forEach((record, index) => {
                    // ç¡®å®šåˆ†æ•°é¢œè‰²
                    let scoreColor = '';
                    if (record.score) {
                        const scoreNum = parseFloat(record.score);
                        if (scoreNum >= 90) scoreColor = '#c8102e';
                        else if (scoreNum >= 80) scoreColor = '#ffd700';
                        else if (scoreNum >= 70) scoreColor = '#228b22';
                        else scoreColor = '#1e90ff';
                    }
                    
                    // åˆ›å»ºè®°å½•é¡¹
                    const recordItem = document.createElement('li');
                    recordItem.className = 'record-item';
                    recordItem.innerHTML = `
                        <div class="record-header">
                            <div class="record-title">${record.title}</div>
                            <div class="record-time">${record.time}</div>
                        </div>
                        ${record.score ? `<div class="record-score" style="background-color: ${scoreColor}">${record.score}</div>` : ''}
                        <div class="record-content">${record.content}</div>
                        <div class="record-actions">
                            <button class="record-btn" onclick="viewRecordDetail('${record.type}', ${index})">æŸ¥çœ‹è¯¦æƒ…</button>
                            <button class="record-btn" onclick="deleteRecord('${record.type}', ${index})">åˆ é™¤</button>
                        </div>
                    `;
                    
                    recordList.appendChild(recordItem);
                });
            }
        }

        // æŸ¥çœ‹è®°å½•è¯¦æƒ…
        function viewRecordDetail(type, index) {
            let records = [];
            
            // æ ¹æ®ç±»å‹è·å–å¯¹åº”è®°å½•
            switch(type) {
                case 'compass':
                    records = JSON.parse(localStorage.getItem('fengshuiResults') || '[]');
                    break;
                case 'house':
                    records = JSON.parse(localStorage.getItem('houseFengshuiResults') || '[]');
                    break;
                case 'fortune':
                    records = JSON.parse(localStorage.getItem('fortuneResults') || '[]');
                    break;
            }
            
            if (index >= 0 && index < records.length) {
                const record = records[index];
                
                // æ„é€ è¯¦æƒ…æ–‡æœ¬
                let detailText = '';
                
                if (type === 'compass') {
                    detailText = `
ã€ç½—ç›˜é£æ°´æµ‹ç®—è¯¦æƒ…ã€‘
æµ‹ç®—æ—¶é—´ï¼š${record.time}
æ–¹ä½è§’åº¦ï¼š${record.rotation}Â°
è¯¦ç»†è§£è¯»ï¼š
${record.content.replace(/<[^>]*>/g, '')}

æ¸©é¦¨æç¤ºï¼šæœ¬æµ‹ç®—ç»“æœåŸºäºä¼ ç»Ÿé£æ°´ç†è®ºï¼Œä»…ä¾›å‚è€ƒã€‚
                    `;
                } else if (type === 'house') {
                    detailText = `
ã€${record.area}é£æ°´æµ‹ç®—è¯¦æƒ…ã€‘
æµ‹ç®—æ—¶é—´ï¼š${record.time}
é£æ°´è¯„åˆ†ï¼š${record.score}åˆ†
è¯¦ç»†è§£è¯»ï¼š
${record.content.replace(/<[^>]*>/g, '')}

æ¸©é¦¨æç¤ºï¼šå®¶å±…é£æ°´è°ƒæ•´å»ºè®®å¯æ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©æ€§é‡‡çº³ã€‚
                    `;
                } else if (type === 'fortune') {
                    detailText = `
ã€${record.userInfo.name || 'æœ‰ç¼˜äºº'}çš„ä»Šæ—¥è¿åŠ¿è¯¦æƒ…ã€‘
æµ‹ç®—æ—¶é—´ï¼š${record.time}
æ•´ä½“è¯„åˆ†ï¼š${record.totalScore.toFixed(1)}åˆ†

åŸºæœ¬ä¿¡æ¯ï¼š
å§“åï¼š${record.userInfo.name || 'æœªå¡«å†™'}
å‡ºç”Ÿæ—¥æœŸï¼š${record.userInfo.birthDate || 'æœªå¡«å†™'}
å‡ºç”Ÿæ—¶è¾°ï¼š${record.userInfo.birthHour || 'æœªå¡«å†™'}
æ€§åˆ«ï¼š${record.userInfo.gender === 'male' ? 'ç”·' : 'å¥³'}

å„ç»´åº¦è¯„åˆ†ï¼š
${record.dimensions.map(d => `${d.name}ï¼š${d.score}åˆ†`).join('\n')}

å…«å­—å‘½ç†è§£è¯»ï¼š
${record.analysis.replace(/<[^>]*>/g, '')}

ä»Šæ—¥å¼€è¿å»ºè®®ï¼š
${record.luckTips.map((tip, i) => `${i+1}. ${tip}`).join('\n')}

æ¸©é¦¨æç¤ºï¼šè¿åŠ¿æµ‹ç®—ä»…ä¾›å¨±ä¹å‚è€ƒï¼Œç”Ÿæ´»ä»éœ€åŠªåŠ›å‰è¡Œã€‚
                    `;
                }
                
                // æ˜¾ç¤ºè¯¦æƒ…å¼¹çª—
                alert(detailText);
            } else {
                alert('è¯¥è®°å½•ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤ï¼');
            }
        }

        // åˆ é™¤å•æ¡è®°å½•
        function deleteRecord(type, index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                return;
            }
            
            let records = [];
            let storageKey = '';
            
            // æ ¹æ®ç±»å‹è·å–å¯¹åº”è®°å½•å’Œå­˜å‚¨é”®
            switch(type) {
                case 'compass':
                    storageKey = 'fengshuiResults';
                    records = JSON.parse(localStorage.getItem(storageKey) || '[]');
                    break;
                case 'house':
                    storageKey = 'houseFengshuiResults';
                    records = JSON.parse(localStorage.getItem(storageKey) || '[]');
                    break;
                case 'fortune':
                    storageKey = 'fortuneResults';
                    records = JSON.parse(localStorage.getItem(storageKey) || '[]');
                    break;
            }
            
            // åˆ é™¤æŒ‡å®šç´¢å¼•çš„è®°å½•
            if (index >= 0 && index < records.length) {
                records.splice(index, 1);
                localStorage.setItem(storageKey, JSON.stringify(records));
                
                // é‡æ–°åŠ è½½è®°å½•
                loadAllRecords();
                // æ›´æ–°ç»Ÿè®¡æ•°å­—
                loadUserInfo();
                
                alert('âœ… è®°å½•å·²æˆåŠŸåˆ é™¤ï¼');
            } else {
                alert('åˆ é™¤å¤±è´¥ï¼šè¯¥è®°å½•ä¸å­˜åœ¨ï¼');
            }
        }

        // ç¼–è¾‘ä¸ªäººä¿¡æ¯
        function editProfile() {
            // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
            const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{"name":"ç„æ˜“å±…å£«","avatar":"ç„"}');
            
            // å¼¹çª—è¾“å…¥æ–°ä¿¡æ¯
            const newName = prompt('è¯·è¾“å…¥æ‚¨çš„æ˜µç§°ï¼š', userInfo.name);
            if (newName && newName.trim()) {
                // è·å–å¤´åƒå­—ç¬¦ï¼ˆå–ç¬¬ä¸€ä¸ªå­—ï¼‰
                const newAvatar = newName.substring(0, 1);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const updatedInfo = {
                    name: newName.trim(),
                    avatar: newAvatar
                };
                localStorage.setItem('userInfo', JSON.stringify(updatedInfo));
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤º
                document.getElementById('displayName').textContent = newName.trim();
                document.getElementById('userAvatar').textContent = newAvatar;
                
                alert('âœ… ä¸ªäººä¿¡æ¯å·²æ›´æ–°ï¼');
            }
        }

        // åˆå§‹åŒ–è®¾ç½®é¡¹
        function initSettings() {
            // æ·±è‰²æ¨¡å¼å¼€å…³ï¼ˆé»˜è®¤å¼€å¯ï¼‰
            document.getElementById('darkModeSwitch').addEventListener('change', function() {
                if (this.checked) {
                    document.body.style.backgroundColor = 'var(--color-black)';
                    document.body.style.color = '#fff';
                } else {
                    document.body.style.backgroundColor = '#fff';
                    document.body.style.color = '#000';
                }
            });
            
            // è¯­éŸ³æ’­æŠ¥å¼€å…³
            document.getElementById('voiceSwitch').addEventListener('change', function() {
                localStorage.setItem('voiceEnabled', this.checked);
                alert(this.checked ? 'âœ… è¯­éŸ³æ’­æŠ¥å·²å¼€å¯' : 'âŒ è¯­éŸ³æ’­æŠ¥å·²å…³é—­');
            });
        }

        // æ¸…é™¤æ‰€æœ‰è®°å½•
        function clearAllRecords() {
            if (!confirm('âš ï¸ ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹ç®—è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            
            // æ¸…é™¤æ‰€æœ‰è®°å½•å­˜å‚¨
            localStorage.removeItem('fengshuiResults');
            localStorage.removeItem('houseFengshuiResults');
            localStorage.removeItem('fortuneResults');
            localStorage.removeItem('fullHouseReports');
            
            // é‡æ–°åŠ è½½è®°å½•ï¼ˆæ˜¾ç¤ºç©ºçŠ¶æ€ï¼‰
            loadAllRecords();
            // æ›´æ–°ç»Ÿè®¡æ•°å­—
            loadUserInfo();
            
            alert('âœ… æ‰€æœ‰æµ‹ç®—è®°å½•å·²æ¸…é™¤ï¼');
        }

        // æ˜¾ç¤ºå…³äºæˆ‘ä»¬
        function showAbout() {
            alert(`
ã€èµ›åšç½—ç›˜ - å›½é£ç„æ˜“ã€‘
ç‰ˆæœ¬ï¼šv1.0.0
å¼€å‘è€…ï¼šç„æ˜“å·¥ä½œå®¤
æ›´æ–°æ—¶é—´ï¼š2026å¹´2æœˆ

âœ¨ äº§å“ä»‹ç»ï¼š
èµ›åšç½—ç›˜æ˜¯ä¸€æ¬¾èåˆä¼ ç»Ÿé£æ°´æ–‡åŒ–ä¸ç°ä»£ç§‘æŠ€çš„æµ‹ç®—å·¥å…·ï¼Œ
æä¾›ç½—ç›˜é£æ°´ã€å®¶å±…é£æ°´ã€ä»Šæ—¥è¿åŠ¿ç­‰å¤šç§æµ‹ç®—åŠŸèƒ½ï¼Œ
æ—¨åœ¨ä¸ºç”¨æˆ·æä¾›ä¸“ä¸šã€æœ‰è¶£çš„é£æ°´æ–‡åŒ–ä½“éªŒã€‚

ğŸ“– å…è´£å£°æ˜ï¼š
æœ¬åº”ç”¨æ‰€æœ‰æµ‹ç®—ç»“æœä»…ä¾›å¨±ä¹å‚è€ƒï¼Œä¸æ„æˆä»»ä½•ä¸“ä¸šå»ºè®®ï¼Œ
è¯·ç†æ€§çœ‹å¾…é£æ°´æ–‡åŒ–ï¼Œåˆ‡å‹¿è¿‡åº¦è¿·ä¿¡ã€‚

â¤ï¸ æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ä¸æ”¯æŒï¼
            `);
        }

        // è”ç³»å®¢æœ
        function contactService() {
            alert(`
ğŸ“ å®¢æœè”ç³»æ–¹å¼ï¼š
å¾®ä¿¡ï¼šcyxl123456
ç”µè¯ï¼š400-123-4567
é‚®ç®±ï¼šservice@cyxl.com
å·¥ä½œæ—¶é—´ï¼š9:00-18:00ï¼ˆå‘¨ä¸€è‡³å‘¨äº”ï¼‰

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿éšæ—¶è”ç³»æˆ‘ä»¬ï¼
            `);
        }
    </script>
</body>
</html>
